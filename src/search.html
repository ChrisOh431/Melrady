<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta
      name="description"
      content="Moledar makes charts that display the intricate differences between songs."
    />
    <link rel="canonical" href="https://moledar.net/" />

    <meta property="og:site_name" content="Moledar" />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://moledar.net/" />
    <meta property="og:title" content="Moledar - Analyze Your Audio" />
    <meta
      property="og:description"
      content="Moledar makes charts that display the intricate differences between songs."
    />
    <meta property="og:image" content="/images/dnda.png" />

    <meta property="twitter:domain" content="moledar.com" />
    <meta property="twitter:card" content="summary_large_image" />
    <meta property="twitter:url" content="https://moledar.net/" />
    <meta property="twitter:title" content="Moledar - Analyze Your Audio" />
    <meta
      property="twitter:description"
      content="Moledar displays and compares the intricate details of multiple songs."
    />
    <meta property="twitter:image" content="/images/dnda.png" />

    <meta name="msapplication-TileColor" content="#da532c" />
    <meta name="theme-color" content="#ffffff" />
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
    <link rel="manifest" href="/site.webmanifest" />
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5" />

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-KyZXEAg3QhqLMpG8r+8fhAXLRk2vvoC2f3B09zVXn8CA5QIVfZOJ3BCsw2P0p/We"
      crossorigin="anonymous"
    />
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-U1DAWAznBHeqEIlVSCgzq+c9gqGAJn5c/t99JyeKa9xxaYpSvHU5awsuZVVFIhvj"
      crossorigin="anonymous"
    ></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.5.0/dist/chart.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600&display=swap"
      rel="stylesheet"
    />

    <link href="/styles/landing.css" rel="stylesheet" />
    <link href="/styles/styles.css" rel="stylesheet" />

    <title>Moledar | Search Tracks</title>
  </head>

  <body>
    <header style="width: 100%">
      <nav class="topbar">
        <span class="moledar">
          <strong> Moledar </strong>
        </span>
        <span>
          <a href="/search">Search</a>
        </span>
        <span>
          <a href="/logout">Logout</a>
        </span>
      </nav>
    </header>

    <div class="container-lg" style="margin-top: 2em">
      <div class="row">
        <h2 style="font-size: calc(1.275rem + 0.3vw)">Enter 1-4 tracks:</h2>
      </div>
      <div class="row" style="align-items: center;">
        <div class="col-sm-9">
          <form id="track-search-form">
            <div class="d-grid gap-3">
              <input
                type="text"
                class="form-control"
                id="track_1_name"
                aria-describedby="Multi-Track Title Input"
                name="track_1_name"
              />
              <input
                type="text"
                class="form-control"
                id="track_2_name"
                aria-describedby="Track 2 Album Title Input"
                name="track_2_name"
              />
              <input
                type="text"
                class="form-control"
                id="track_3_name"
                aria-describedby="Track 3 Title Input"
                name="track_3_name"
              />
              <input
                type="text"
                class="form-control"
                id="track_4_name"
                aria-describedby="Track 4 Title Input"
                name="track_4_name"
              />
            </div>
          </form>
        </div>

        <div class="col-sm-3 justify-content-center mt-4 mt-sm-0">
          <div class="d-grid gap-2">
            <button
              type="button"
              id="search-button"
              class="btn btn-primary btn-lg"
            >
              Search Spotify
            </button>

            <button
              type="reset"
              form="track-search-form"
              id="reset-button"
              class="btn btn-danger"
            >
              Reset
            </button>
          </div>
        </div>
      </div>

      <div id="results" class="row">
        <div class="col-sm-4 text-center container p-3 p-sm-0">
          <div id="cover-art-container" class="row" />
        </div>
        <div id="stats-button-container" class="col-12 text-center" style="margin-top: 0.5em;"/>
      </div>
    </div>

    <script src="/scripts/formSubmit.js"></script>
    <script src="/scripts/resultDisplay.js"></script>
    <script src="/scripts/albumDisplay.js"></script>
    <script src="/scripts/statsButtonDisplay.js"></script>
  </body>

  <script>
    const get_tops = async () => {
      let response = await fetch("/favies");
      let favetracks = await response.json();
      return favetracks["faves"];
    };

    $(document).ready(async function () {
      let fvs = await get_tops();
      let pickeds = [];

      if (fvs[0] === "Enter 1-4 tracks.") {
        for (let i = 1; i < 5; i++) {
          $(`#track_${i}_name`).attr("placeholder", fvs[0]);
        }
        return;
      }

      for (let i = 1; i < 5; i++) {
        let random_track = fvs[Math.floor(Math.random() * fvs.length)];
        let { track_name, track_album } = random_track;

        let track_option = `${track_name} (${track_album})`;
        if (pickeds.indexOf(track_option) > -1) {
          /* just try it twice, 
                    if it's still the same then either there's < 4 top tracks on the account or bad luck
                */
          random_track = fvs[Math.floor(Math.random() * fvs.length)];
          ({ track_name, track_album } = random_track);
          track_option = `${track_name} (${track_album})`;
        }

        pickeds.push(track_option);
        $(`#track_${i}_name`).attr("placeholder", track_option);
      }
    });
  </script>
</html>
