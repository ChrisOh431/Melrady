<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Moledar makes charts that display the intricate differences between songs.">
    <link rel="canonical" href="https://moledar.net/">

    <meta property="og:site_name" content="Moledar">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://moledar.net/">
    <meta property="og:title" content="Moledar - Analyze Your Audio">
    <meta property="og:description"
        content="Moledar makes charts that display the intricate differences between songs.">
    <meta property="og:image" content="/images/dnda.png">

    <meta property="twitter:domain" content="moledar.com">
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://moledar.net/">
    <meta property="twitter:title" content="Moledar - Analyze Your Audio">
    <meta property="twitter:description"
        content="Moledar displays and compares the intricate details of multiple songs.">
    <meta property="twitter:image" content="/images/dnda.png">

    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="theme-color" content="#ffffff">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-KyZXEAg3QhqLMpG8r+8fhAXLRk2vvoC2f3B09zVXn8CA5QIVfZOJ3BCsw2P0p/We" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-U1DAWAznBHeqEIlVSCgzq+c9gqGAJn5c/t99JyeKa9xxaYpSvHU5awsuZVVFIhvj"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.5.0/dist/chart.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600&display=swap" rel="stylesheet">

    <link href="/styles/landing.css" rel="stylesheet">
    <link href="/styles/styles.css" rel="stylesheet">

    <title>Moledar | Search Tracks</title>
</head>

<body>
    <header>
        <nav class="topbar">
            <span class="moledar">
                <strong>
                    Moledar
                </strong>
            </span>
            <span>
                <a href="/search">Search</a>
            </span>
            <span>
                <a href="/logout">Logout</a>
            </span>
        </nav>
    </header>
    <div style="width: 100%; margin-bottom: 2em;"></div>
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        Track Search
                    </div>

                    <div class="card-body">
                        <div class="container">
                            <div class="row" style="align-items:center;">
                                <div class="col-sm-9">
                                    <form id="track-search-form">
                                        <div class="d-grid gap-3">
                                            <input type="text" class="form-control" id="track_1_name"
                                                aria-describedby="Multi-Track Title Input" name="track_1_name">
                                            <input type="text" class="form-control" id="track_2_name"
                                                aria-describedby="Track 2 Album Title Input" name="track_2_name">
                                            <input type="text" class="form-control" id="track_3_name"
                                                aria-describedby="Track 3 Title Input" name="track_3_name">
                                            <input type="text" class="form-control" id="track_4_name"
                                                aria-describedby="Track 4 Title Input" name="track_4_name">
                                        </div>
                                    </form>
                                </div>

                                <div class="col-sm-3 justify-content-center mt-2 mt-sm-0">
                                    <div class="d-grid gap-2">
                                        <button type="button" id="search-button" class="btn btn-primary btn-lg">Search
                                            Tracks</button>

                                        <button type="reset" form="track-search-form" id="reset-button"
                                            class="btn btn-danger">Reset</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div style="width: 100%; margin-bottom: 2em;"></div>

        <div class="accordion" id="tracks-accordion">

            <div class="accordion-item">
                <h2 class="accordion-header" id="track-1-heading">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                        data-bs-target="#track-1-accordion" aria-expanded="false" aria-controls="track-1-accordion">
                        Track 1
                    </button>
                </h2>
                <div id="track-1-accordion" class="accordion-collapse collapse" aria-labelledby="track-1-heading">
                    <div class="accordion-body">
                        <div id="card-1-list"></div>
                    </div>
                </div>
            </div>

            <div class="accordion-item">
                <h2 class="accordion-header" id="track-2-heading">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                        data-bs-target="#track-2-accordion" aria-expanded="false" aria-controls="track-2-accordion">
                        Track 2
                    </button>
                </h2>
                <div id="track-2-accordion" class="accordion-collapse collapse" aria-labelledby="track-2-heading">
                    <div class="accordion-body">
                        <div id="card-2-list"></div>
                    </div>
                </div>
            </div>

            <div class="accordion-item">
                <h2 class="accordion-header" id="track-3-heading">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                        data-bs-target="#track-3-accordion" aria-expanded="false" aria-controls="track-3-accordion">
                        Track 3
                    </button>
                </h2>
                <div id="track-3-accordion" class="accordion-collapse collapse" aria-labelledby="track-3-heading">
                    <div class="accordion-body">
                        <div id="card-3-list"></div>
                    </div>
                </div>
            </div>

            <div class="accordion-item">
                <h2 class="accordion-header" id="track-4-heading">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                        data-bs-target="#track-4-accordion" aria-expanded="false" aria-controls="track-4-accordion">
                        Track 4
                    </button>
                </h2>
                <div id="track-4-accordion" class="accordion-collapse collapse" aria-labelledby="track-4-heading">
                    <div class="accordion-body">
                        <div id="card-4-list"></div>
                    </div>
                </div>
            </div>
        </div>

        <div style="width: 100%; margin-bottom: 1em;"></div>
        <div id="selections-container" class="container">
            <h3 id="selections-label"></h3>
            <div class="row">
                <div class="album-row">
                    <div id="album-cover-row" class="row justify-content-center">
                    </div>
                </div>
            </div>
            <div style="width: 100%; margin-bottom: 1em;"></div>
            <div class="row">
                <a id="stats-button" href="/stats" class="btn btn-success" role="button">Visualize</a>
            </div>
        </div>
        <div style="width: 100%; margin-bottom: 1em;"></div>
    </div>

    <script src="/scripts/formSubmit.js"></script>
</body>

<script>
    const get_tops = async () =>
    {
        let response = await fetch("/favies");
        let favetracks = await response.json();
        return favetracks["faves"];
    }

    $(document).ready(async function ()
    {
        let fvs = await get_tops();
        let pickeds = [];

        if (fvs[0] === "Enter 1-4 tracks.")
        {
            for (let i = 1; i < 5; i++)
            {
                $(`#track_${i}_name`).attr('placeholder', fvs[0]);
            }
            return;
        }

        for (let i = 1; i < 5; i++)
        {
            let random_track = fvs[Math.floor(Math.random() * fvs.length)];
            let { track_name, track_album } = random_track;

            let track_option = `${track_name} (${track_album})`;
            if (pickeds.indexOf(track_option) > -1)
            {
                /* just try it twice, 
                    if it's still the same then either there's < 4 top tracks on the account or bad luck
                */
                random_track = fvs[Math.floor(Math.random() * fvs.length)];
                ({ track_name, track_album } = random_track);
                track_option = `${track_name} (${track_album})`;
            }

            pickeds.push(track_option);
            $(`#track_${i}_name`).attr('placeholder', track_option);
        }
    });
</script>

</html>